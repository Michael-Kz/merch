# Astra Child Theme

Дочерняя тема для Astra с интегрированной бонусной программой и кастомизированной корзиной.

## Описание

Эта дочерняя тема включает в себя:

- **Рефакторинг бонусной программы** - вынесение функционала из основной темы в отдельные классы
- **Кастомизированный шаблон корзины** - современный и удобный интерфейс корзины
- **Оптимизированная структура ресурсов** - правильное подключение CSS и JS файлов
- **Платежные шлюзы для баллов** - интеграция с системой лояльности

## Структура файлов

```
astra-child/
├── assets/
│   ├── css/
│   │   └── main.css
│   └── js/
│       ├── main.js
│       └── loyalty.js
├── inc/
│   ├── class-alean-loyalty-plugin.php
│   ├── class-theme-assets.php
│   ├── class-cart-template.php
│   └── gateways/
│       ├── class-wc-points-payment-gateway.php
│       └── class-wc-alean-loyalty-gateway.php
├── template-parts/
│   └── woocommerce/
│       └── cart/
│           └── cart.php
├── functions.php
├── style.css
└── README.md
```

## Установка

1. Скопируйте папку `astra-child` в директорию `/wp-content/themes/`
2. Активируйте тему в админ-панели WordPress
3. Убедитесь, что родительская тема Astra активна

## Функциональность

### Бонусная программа

- **Класс `Alean_Loyalty_Plugin`** - основной класс для работы с бонусной программой
- **REST API** - эндпоинты для получения и списания баллов
- **AJAX обработчики** - для динамического обновления данных
- **Платежные шлюзы** - для оплаты баллами

### Кастомизированная корзина

- **Современный дизайн** - адаптивный интерфейс
- **Интеграция с лояльностью** - отображение баланса баллов
- **Улучшенные поля количества** - с кнопками +/- 
- **Дополнительные поля** - примечания, подарочная упаковка

### Управление ресурсами

- **Класс `Theme_Assets`** - централизованное управление CSS/JS
- **Оптимизация загрузки** - preload, defer, lazy loading
- **Минификация** - встроенные функции минификации
- **Условная загрузка** - загрузка ресурсов только при необходимости

## Настройка

### Бонусная программа

1. Настройте API эндпоинты в классе `Alean_Loyalty_Plugin`
2. Добавьте реальную логику получения данных лояльности
3. Настройте платежные шлюзы в WooCommerce

### Стили

Основные стили находятся в `assets/css/main.css`:

- CSS переменные для цветов и размеров
- Адаптивный дизайн
- Компоненты UI (кнопки, формы, модальные окна)

### JavaScript

- `main.js` - основная функциональность
- `loyalty.js` - функциональность лояльности

## API эндпоинты

### Получение данных лояльности
```
GET /wp-json/alean/v1/bonus
```

### Списание баллов
```
POST /wp-json/alean/v1/spend-points
{
    "amount": 1000,
    "order_id": "123"
}
```

## AJAX действия

### Получение данных лояльности
```javascript
$.post(ajaxurl, {
    action: 'get_loyalty_data',
    nonce: aleanLoyalty.nonce
}, function(response) {
    // Обработка ответа
});
```

## Хуки и фильтры

### WooCommerce
- `woocommerce_locate_template` - переопределение шаблона корзины
- `woocommerce_cart_item_quantity` - кастомизация поля количества
- `woocommerce_payment_gateways` - добавление платежных шлюзов

### WordPress
- `wp_enqueue_scripts` - подключение ресурсов
- `rest_api_init` - регистрация REST API
- `wp_ajax_*` - AJAX обработчики

## Производительность

### Оптимизации

1. **Ленивая загрузка изображений** - через Intersection Observer
2. **Условная загрузка ресурсов** - только на нужных страницах
3. **Минификация CSS/JS** - встроенные функции
4. **Preload критических ресурсов** - для ускорения загрузки

### Кэширование

- Версионирование файлов через `filemtime()`
- Правильные заголовки кэширования
- Оптимизация загрузки шрифтов

## Безопасность

- Проверка nonce для всех AJAX запросов
- Валидация входных данных
- Санитизация выходных данных
- Проверка прав пользователя

## Совместимость

- WordPress 5.0+
- WooCommerce 5.0+
- PHP 7.4+
- Astra Theme 3.0+

## Разработка

### Добавление новых функций

1. Создайте новый класс в папке `inc/`
2. Подключите класс в `functions.php`
3. Добавьте необходимые хуки и фильтры

### Кастомизация стилей

1. Редактируйте `assets/css/main.css`
2. Используйте CSS переменные для консистентности
3. Следуйте принципам адаптивного дизайна

### Добавление JavaScript

1. Создайте новый файл в `assets/js/`
2. Подключите в классе `Theme_Assets`
3. Используйте модульную структуру

## Поддержка

При возникновении проблем:

1. Проверьте консоль браузера на ошибки JavaScript
2. Убедитесь, что все зависимости подключены
3. Проверьте логи WordPress
4. Убедитесь в совместимости версий

## Лицензия

GPL v2 или более поздняя версия